Title: AWS EC2 と GitHub Pages で作る 無料ハニーポット&公開ページ（作成中）(3)
Date: 2020-05-07
Category: Tech
Tags: AWS, EC2, GitHubPages, Python, ハニーポット
Slug: pot3
Authors: s.hosoya

[昨日](https://blog.watarinohibi.tokyo/posts/2020/05/06/pot/#pot)の続き。

## bugfix

ログ取得スクリプトにバグがあり対応。  
23時台のログだけ日付が間違っている（翌日の日付が入ってしまっている）ことがあったのに気付き修正。    
原因はシンプルで、ログに挿入する日付を生成するときに、  

* 現在時刻を取得  
* 取得した現在時刻から日付を生成  

としていたため、24時を回った0時台に前日23時台のログを取得した場合に、ログから見たら「翌日」の日付となってしまっていた。  
[Issue](https://github.com/mollinaca/pot/issues/3)  

## 機能追加

### 国コードの取得と表示

ログ生成の際に、アクセス元IPアドレスからカントリーコードを取得してログに挿入するようにした。  
また、IPアドレス表示の際にあわせてカントリーコードを表示するようにしてみた。  

![current_index](https://blog.watarinohibi.tokyo/images/20200507_pot_current_index.png "current_index")   

見てると、NL（オランダ）が結構多い模様？以外。  
経験上、この手のアクセスは大抵ホスティングベンダからなので、そういうことをさせちゃってるベンダがあるんだろうな。そこまで調べてないけど。  
カントリーコードはWhois引けばほぼ確実にとれるからいいけど、事業者情報とれたりとれなかったりするので、そこまでパースするのはマンドクセーからいいや。  

### 24時間分のログを作成

0時を回ったタイミングで、前日1日分の24時間のログを集計した24時間分ログを作成するようにした。  
ただしこれを表示する機能がまだないので、表示はできていない。  
いずれ、ページで「1時間単位」or「1日単位」で選択できるようにして、日付と時刻から該当のログを引っ張れるようにしたい。そんな難しくないはず。  

## やってみたけどやめた

ログや各種情報が表示されるまでに、ロード中のぐるぐるを出しておこうと思ってやってみたけど、現状API一発で1秒未満で表示されるので、一瞬表示されるだけだったのでやめた。  
ちなみにぐるぐるはこのページから借りた。  

[Preloaders.net](https://icons8.com/preloaders)  

いろいろあって楽しい。ほんとに必要そうになったらまた借りよう。  

### 引き続きやること

* フロントエンドのいいカンジ化、APIを使って json のデータはなんとかとれたので、これを集計してチャートにしてみたい    
    * テーブルはだせたので、チャートやグラフとか。なんかそういうライブラリあると思うので調べる  
    → google のグラフ描画のやつが良さそう。地理情報からも出せるっぽい。デベロッパキーがいるみたいだけどまた調べてみよう  
* 別の日時を指定してデータを表示とか  
    * 日時、時刻を指定して、そのタイミングで情報を更新する昨日  
    * いまは1時間単位のデータなので、1日単位とか、一定期間とか？  
    → 1日単位はログ作った
* エラー処理（Gitへのコミット失敗（GitHubたまに落ちてるしね）を検知して通知、再実行とか）    
* 他のログの追加  
    * ページをタブ化して、デフォルトでssh（secure）ログを選択しつつ、タブ切り替えでほかのログを同じように表示するとか  

